local branchheadsfile i_tiphash i_branchname
local -a branchheads

local branchheadsfile=${hook_com[base]}/.hg/branchheads.cache
[[ -s ${hook_com[base]}/.hg/patches/status ]] && return 0

if [[ -r ${branchheadsfile} ]] ; then
  while read -r i_tiphash i_branchname ; do
    branchheads+=( $i_tiphash )
  done < ${branchheadsfile}

  if [[ ! ${branchheads[(i)${user_data[hash]}]} -le ${#branchheads} ]] ; then
    hook_com[revision]="^ ${hook_com[revision]}"
  fi
fi
