# vim: ft=zsh ts=2 sw=2 et fenc=utf-8

p10ks_gitstatus_async_started ()
{
  # _display_hidden is hooked on the empty scalar:
  p10ks_gitstatus["prompt"]="${p10ks_gitstatus[loading_msg]}"
  p10ks_gitstatus[status]="loading"
}

[[ "${(t)p10ks_gitstatus}" != "association" ]] && {
  typeset -gA p10ks_gitstatus
}
# env-vars {{{
# p10ks_gitstatus[loading_msg] -> message while waiting for async process
# (set to blank string to hide the segment during async wait)
p10ks_gitstatus[loading_msg]=${p10ks_gitstatus[loading_msg]:-"<loading...>"}
# }}}

# resets the async status when done with renders
function _p10ks_gitstatus_async_complete () {
  _p10k_segment_async_reset_status p10ks_gitstatus
}

_p10k_add_hook _p10k_async_complete _p10ks_gitstatus_async_complete

p10ks_gitstatus_async_started "$@"
