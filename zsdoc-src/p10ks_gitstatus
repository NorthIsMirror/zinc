

# AUTOGENERATED - DO NOT EDIT
# vim: ft=zsh ts=2 sw=2 et fenc=utf-8

# synopsis {{{
# If https://github.com/romkatv/gitstatus plugin is enabled and the current directory is
# within a git repo, this segment displays the same prompt as vcs segment but 3 times faster.
# Otherwise it does nothing.
#
# Is async and will talk to git in worker process.
# }}}

function zincs_gitstatus () {
  REPLY="${zincs_gitstatus["prompt"]}"
}

typeset -gA zincs_gitstatus
zincs_gitstatus["prompt"]="<async:gitstatus>"
zincs_gitstatus[status]="loading"

zincs_gitstatus "$@"

# AUTOGENERATED - DO NOT EDIT

# AUTOGENERATED - DO NOT EDIT
# vim: ft=zsh ts=2 sw=2 et fenc=utf-8

function zincs_gitstatus_default_opts () {
  reply=(black CONDITIONAL CONDITIONAL async)
}

# AUTOGENERATED - DO NOT EDIT

# AUTOGENERATED - DO NOT EDIT
# vim: ft=zsh ts=2 sw=2 et fenc=utf-8

function zincs_gitstatus_display_hidden () {
  [[ "${zincs_gitstatus["prompt"]}" == "" ]] && true || false
}

# AUTOGENERATED - DO NOT EDIT

# AUTOGENERATED - DO NOT EDIT
# vim: ft=zsh ts=2 sw=2 et fenc=utf-8

function zincs_gitstatus_bg () {
  case "${zincs_gitstatus[status]}" in
    "dirty") REPLY=${zincs_gitstatus[color_dirty]} ;;
    "loading") REPLY=${zincs_gitstatus[color_loading]} ;;
    *) REPLY=${zincs_gitstatus[color_default]} ;;
  esac
}

# env-vars {{{
# zincs_gitstatus[color_dirty] -> bgcolor when repo is dirty
zincs_gitstatus[color_dirty]=${zincs_gitstatus[color_dirty]:-"yellow"}
# zincs_battery[color_loading] -> bgcolor while async process is running
zincs_gitstatus[color_loading]=${zincs_gitstatus[color_loading]:-"8"}
# zincs_gitstatus[color_default] -> color when repo is clean
zincs_gitstatus[color_default]=${zincs_gitstatus[color_default]:-"green"}
# }}}

zincs_gitstatus_bg "$@"

# AUTOGENERATED - DO NOT EDIT

# AUTOGENERATED - DO NOT EDIT


# AUTOGENERATED - DO NOT EDIT

# AUTOGENERATED - DO NOT EDIT
# vim: ft=zsh ts=2 sw=2 et fenc=utf-8

zincs_gitstatus_async ()
{
  gitstatus_query_dir || return
  echo -nE "$((VCS_STATUS_HAS_STAGED || VCS_STATUS_HAS_UNSTAGED)),;;;"

  echo -nE "$VCS_STATUS_LOCAL_BRANCH"
  if [[ -n "$VCS_STATUS_ACTION" ]]; then
    echo -nE "%F{${red}}| $VCS_STATUS_ACTION%f"
  else
    if [[ -n "$VCS_STATUS_REMOTE_BRANCH" &&
          "$VCS_STATUS_LOCAL_BRANCH" != "$VCS_STATUS_REMOTE_BRANCH" ]]; then
      echo -nE $' → '"$VCS_STATUS_REMOTE_BRANCH"
    fi
    local icons=''
    (( VCS_STATUS_HAS_STAGED == 1 )) && icons+='✚'
    (( VCS_STATUS_HAS_UNSTAGED == 1 )) && icons+='●'
    (( VCS_STATUS_HAS_UNTRACKED == 1 )) && icons+='◌'
    echo -nE "${icons:+ $icons}"
    (( VCS_STATUS_COMMITS_AHEAD > 0 )) && echo -nE " +$VCS_STATUS_COMMITS_AHEAD"
    (( VCS_STATUS_COMMITS_BEHIND > 0 )) && echo -nE " -$VCS_STATUS_COMMITS_BEHIND"
  fi
}

zincs_gitstatus_async "$@"

# AUTOGENERATED - DO NOT EDIT

# AUTOGENERATED - DO NOT EDIT
# vim: ft=zsh ts=2 sw=2 et fenc=utf-8

zincs_gitstatus_async_return ()
{
  # $1 return code
  # $2 resulting (stdout) output from job execution
  # $3 execution time, floating point e.g. 0.0076138973 seconds
  # $4 resulting (stderr) error output from job execution

  local -a tmp
  tmp=("${(s.;;;.)2}")
  zincs_gitstatus["prompt"]="${tmp[2]}"
  tmp=("${(s.,.)tmp}")
  (( ${tmp[1]} )) && zincs_gitstatus[status]="dirty" || zincs_gitstatus[status]="returned"
}

zincs_gitstatus_async_return "$@"

# AUTOGENERATED - DO NOT EDIT

# AUTOGENERATED - DO NOT EDIT
# vim: ft=zsh ts=2 sw=2 et fenc=utf-8

zincs_gitstatus_async_started ()
{
  # _display_hidden is hooked on the empty scalar:
  zincs_gitstatus["prompt"]="${zincs_gitstatus[loading_msg]}"
  zincs_gitstatus[status]="loading"
}

[[ "${(t)zincs_gitstatus}" != "association" ]] && {
  typeset -gA zincs_gitstatus
}
# env-vars {{{
# zincs_gitstatus[loading_msg] -> message while waiting for async process
# (set to blank string to hide the segment during async wait)
zincs_gitstatus[loading_msg]=${zincs_gitstatus[loading_msg]:-"<loading...>"}
# }}}

# resets the async status when done with renders
function _zincs_gitstatus_async_complete () {
  _zinc_segment_async_reset_status zincs_gitstatus
}

_zinc_add_hook _zinc_async_complete _zincs_gitstatus_async_complete

zincs_gitstatus_async_started "$@"

# AUTOGENERATED - DO NOT EDIT
